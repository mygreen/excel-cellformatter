<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ja"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>KansujiConverter.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Excel-CellFormatter</a> &gt; <a href="index.source.html" class="el_package">com.github.mygreen.cellformatter.callback</a> &gt; <span class="el_source">KansujiConverter.java</span></div><h1>KansujiConverter.java</h1><pre class="source lang-java linenums">package com.github.mygreen.cellformatter.callback;

import java.util.ArrayList;
import java.util.Collections;
import java.util.List;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

import com.github.mygreen.cellformatter.lang.ArgUtils;

/**
 * 数字の表現を漢数字に変換する。
 * &lt;p&gt;数字が連続しないと、桁数を考慮した変換はできない。&lt;/p&gt;
 * &lt;p&gt;途中に区切り文字などがあると、そこで途切れる。&lt;/p&gt;
 * &lt;p&gt;大字の定義：&lt;a href=&quot;http://www.benricho.org/kanji/kansuji.html&quot;&gt;漢数字と大字〔だいじ〕の書き方&lt;/a&gt;&lt;/p&gt;
 *
 * @since 2.0
 * @author T.TSUCHIE
 *
 */
<span class="fc" id="L21">public class KansujiConverter {</span>

    /**
     * 整数部分の切り出し用正規表現
     */
<span class="fc" id="L26">    protected static final Pattern PATTERN_NUM = Pattern.compile(&quot;([\\D]*)([\\d]+)([\\.]{0,1}[.\\s\\w]*)&quot;);</span>

    /**
     * 0～9の数字のマップ
     */
<span class="fc" id="L31">    protected String[] numMap = {</span>
        &quot;〇&quot;,
        &quot;一&quot;,
        &quot;二&quot;,
        &quot;三&quot;,
        &quot;四&quot;,
        &quot;五&quot;,
        &quot;六&quot;,
        &quot;七&quot;,
        &quot;八&quot;,
        &quot;九&quot;
    };

    /**
     * 10^4ごとの桁単位のマップ
     * &lt;p&gt;&lt;a href=&quot;http://www2s.biglobe.ne.jp/~hotori/kazu.html&quot;&gt;桁数の名前&lt;/a&gt;
     */
<span class="fc" id="L48">    protected String[] digits10Map = {</span>
        &quot;&quot;,      // 10^0
        &quot;万&quot;,    // 10^4
        &quot;億&quot;,    // 10^8
        &quot;兆&quot;,    // 10^12
        &quot;京&quot;,    // 10^16
    };

    /**
     * 4桁の桁単位のマップ
     */
<span class="fc" id="L59">    protected String[] digits4Map = {</span>
        &quot;&quot;,
        &quot;十&quot;,
        &quot;百&quot;,
        &quot;千&quot;,
    };

    /**
     * 文字列を変換する
     * @param value 変換対象の値
     * @param is4YearTerm 4桁の年指定の項の場合
     * @return 変換後の値
     */
    public String convert(final String value, final boolean is4YearTerm) {

<span class="fc" id="L74">        final Matcher matcher = PATTERN_NUM.matcher(value);</span>
<span class="fc bfc" id="L75" title="All 2 branches covered.">        if(!matcher.matches()) {</span>
            // 一致しない場合は、単純に数値の変換
<span class="fc" id="L77">            return replaceSimple(value);</span>
        }

<span class="fc" id="L80">        final String before = matcher.group(1);</span>
<span class="fc" id="L81">        final String num = matcher.group(2);</span>
<span class="fc" id="L82">        final String after = matcher.group(3);</span>

<span class="pc bpc" id="L84" title="1 of 4 branches missed.">        if(is4YearTerm &amp;&amp; num.length() == 4) {</span>
            // 年の桁は、単純に数値変換する
<span class="fc" id="L86">            return replaceSimple(before) + replaceSimple(num) + replaceSimple(after);</span>

        } else {
<span class="fc" id="L89">            return replaceSimple(before) + replaceDisits(num) + replaceSimple(after);</span>

        }

    }

    /**
     * 数字を単純に変換する。
     * @param value 変換対象の文字列
     * @return
     */
    protected String replaceSimple(final String value) {
<span class="fc" id="L101">        String str = value;</span>
<span class="fc bfc" id="L102" title="All 2 branches covered.">        for(int i=0; i &lt; numMap.length; i++) {</span>
<span class="fc" id="L103">            str = str.replaceAll(String.valueOf(i), numMap[i]);</span>
        }

<span class="fc" id="L106">        return str;</span>
    }

    /**
     * 数字を桁数に合わせて変換する。
     * @param value
     * @return
     */
    protected String replaceDisits(final String value) {

<span class="fc bfc" id="L116" title="All 2 branches covered.">        if(value.equals(&quot;0&quot;)) {</span>
<span class="fc" id="L117">            return numMap[0];</span>
        }

        // 4桁ごとに、分割する。
<span class="fc" id="L121">        final int length = value.length();</span>
<span class="fc" id="L122">        final List&lt;String&gt; split4 = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L123" title="All 2 branches covered.">        for(int i=0; i &lt; length; i=i+4) {</span>

            // 下の桁から切り出す
<span class="fc" id="L126">            int end = length -i;</span>
            int start;
<span class="fc bfc" id="L128" title="All 2 branches covered.">            if(i + 4 &lt; length) {</span>
<span class="fc" id="L129">                start = end - 4;</span>
            } else {
<span class="fc" id="L131">                start = 0;</span>
            }
<span class="fc" id="L133">            String item = value.substring(start, end);</span>
<span class="fc" id="L134">            split4.add(item);</span>
        }

        // 4桁ごとに変換を行う。
<span class="fc" id="L138">        final List&lt;String&gt; digits = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L139" title="All 2 branches covered.">        for(int i=0; i &lt; split4.size(); i++) {</span>
<span class="fc" id="L140">            String item = split4.get(i);</span>
<span class="fc" id="L141">            item = replace4Digits(item) + digits10Map[i];</span>

<span class="fc" id="L143">            digits.add(item);</span>
        }

        /*
         * 文字列に直す。
         * ・桁数が逆順になっているので、戻し結合する。
         */
<span class="fc" id="L150">        Collections.reverse(digits);</span>
<span class="fc" id="L151">        StringBuilder sb = new StringBuilder();</span>
<span class="fc bfc" id="L152" title="All 2 branches covered.">        for(String item : digits) {</span>
<span class="fc" id="L153">            sb.append(item);</span>
<span class="fc" id="L154">        }</span>

<span class="fc" id="L156">        return sb.toString();</span>
    }

    /**
     * 4桁以下の数字を、漢数字に変換する。
     * @param value
     * @return
     */
    protected String replace4Digits(final String value) {

        // 桁ごとに変換を行う。
<span class="fc" id="L167">        final int length = value.length();</span>
<span class="fc" id="L168">        final List&lt;String&gt; digits = new ArrayList&lt;&gt;();</span>

<span class="fc bfc" id="L170" title="All 2 branches covered.">        for(int i=0; i &lt; length; i++) {</span>
            // 下の桁から処理する
<span class="fc" id="L172">            final char c = value.charAt(length-i-1);</span>
<span class="fc bfc" id="L173" title="All 2 branches covered.">            if(c == '0') {</span>
<span class="fc" id="L174">                continue;</span>

            }

            String item;
<span class="fc bfc" id="L179" title="All 4 branches covered.">            if(c == '1' &amp;&amp; i &gt; 0) {</span>
                // 10の位以上で、かつ1の場合、数字部分は省略し、桁数のみにする。
<span class="fc" id="L181">                item = digits4Map[i];</span>
            } else {
<span class="fc" id="L183">                item = replaceSimple(String.valueOf(c)) + digits4Map[i];</span>
            }

<span class="fc" id="L186">            digits.add(item);</span>

        }

        /*
         * 文字列に直す。
         * ・桁数が逆順になっているので、戻し結合する。
         */
<span class="fc" id="L194">        Collections.reverse(digits);</span>
<span class="fc" id="L195">        StringBuilder sb = new StringBuilder();</span>
<span class="fc bfc" id="L196" title="All 2 branches covered.">        for(String item : digits) {</span>
<span class="fc" id="L197">            sb.append(item);</span>
<span class="fc" id="L198">        }</span>

<span class="fc" id="L200">        return sb.toString();</span>

    }

    /**
     * 0～9の数字のマップを設定する
     * @param numMap 配列のインデックスに対応する数字のマップ
     * @throws IllegalArgumentException {@literal numMap size != 10}
     */
    public void setNumMap(String[] numMap) {
<span class="fc" id="L210">        ArgUtils.notEmpty(numMap, &quot;numMap&quot;);</span>

<span class="pc bpc" id="L212" title="1 of 2 branches missed.">        if(numMap.length != 10) {</span>
<span class="nc" id="L213">            throw new IllegalArgumentException(&quot;numMap length should be 10.&quot;);</span>
        }

<span class="fc" id="L216">        this.numMap = numMap;</span>
<span class="fc" id="L217">    }</span>

    /**
     * 10^4ごとの桁単位のマップ
     * @param digits10Map 万、億などの桁のマップ。
     * @throws IllegalArgumentException {@literal digits10Map size != 5}
     */
    public void setDigits10Map(String[] digits10Map) {
<span class="fc" id="L225">        ArgUtils.notEmpty(digits10Map, &quot;digits10Map&quot;);</span>

<span class="pc bpc" id="L227" title="1 of 2 branches missed.">        if(digits10Map.length != 5) {</span>
<span class="nc" id="L228">            throw new IllegalArgumentException(&quot;digits10Map length should be 5.&quot;);</span>
        }

<span class="fc" id="L231">        this.digits10Map = digits10Map;</span>
<span class="fc" id="L232">    }</span>

    /**
     * 4桁の桁単位のマップ
     * @param digits4Map 十、百などの桁のマップ
     * @throws IllegalArgumentException {@literal digits4Map size != 4}
     */
    public void setDigits4Map(String[] digits4Map) {

<span class="fc" id="L241">        ArgUtils.notEmpty(digits4Map, &quot;digits4Map&quot;);</span>

<span class="pc bpc" id="L243" title="1 of 2 branches missed.">        if(digits4Map.length != 4) {</span>
<span class="nc" id="L244">            throw new IllegalArgumentException(&quot;digits4Map length should be 4.&quot;);</span>
        }

<span class="fc" id="L247">        this.digits4Map = digits4Map;</span>
<span class="fc" id="L248">    }</span>

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span></div></body></html>